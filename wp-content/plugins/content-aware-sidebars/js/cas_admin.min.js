/*!
 * @package Content Aware Sidebars
 * @author Joachim Jensen <jv@intox.dk>
 * @license GPLv3
 * @copyright 2018 by Joachim Jensen
 */
!function($){"use strict";var t={current_section:0,sections:[],init:function(){this.tabController(),this.actionOptionHandler(),this.suggestVisibility(),this.initSidebarActivation(),$(".js-cas-color-field").wpColorPicker(),$(".js-cas-html").on("change",function(t){var e=$(this);$(e.data("target")).attr("disabled",!e.is(":checked"))}).trigger("change")},initSidebarActivation:function(){flatpickr.l10ns.default.weekdays=CASAdmin.weekdays,flatpickr.l10ns.default.months=CASAdmin.months,flatpickr.l10ns.default.firstDayOfWeek=CASAdmin.weekStart;var t=flatpickr(".js-cas-activation",{wrap:!0,clickOpens:!0,enableTime:!0,time_24hr:!0,allowInput:!0,enableSeconds:!0,onChange:function(t,i,s){(i||e.config.minDate)&&e.set("minDate",i?new Date(t).fp_incr(1):null),i?n.prop("checked",!1):n.is(":checked")||e.clear()}}),e=flatpickr(".js-cas-expiry",{wrap:!0,clickOpens:!0,enableTime:!0,time_24hr:!0,allowInput:!0,enableSeconds:!0,onChange:function(e,n,i){(n||t.config.maxDate)&&t.set("maxDate",n?new Date(e).fp_incr(-1):null)}}),n=$(".js-cas-status");n.on("change",function(n){$(this).is(":checked")?t.clear():t.selectedDates.length||e.clear()})},initTabSections:function(){$(".js-cas-tabs").find(".nav-tab").each(function(){var e=this.href.lastIndexOf("#");if(e>=0){var n=this.href.substr(e);t.sections.push(n),$(n).hide()}})},tabController:function(){this.initTabSections(),this.setCurrentSection(window.location.hash),$("#poststuff").on("click",".js-nav-link",function(e){t.setCurrentSection(this.href)})},findSectionByURL:function(t){var e=this.sections.indexOf(t.substring(t.lastIndexOf("#")));return e>=0?e:null},setCurrentSection:function(t){var e=this.findSectionByURL(t)||0,n=$(".js-cas-tabs").find(".nav-tab");n.eq(e).is(":visible")&&($(this.sections[this.current_section]).hide(),n.eq(this.current_section).removeClass("nav-tab-active"),this.current_section=e,$(this.sections[this.current_section]).show(),n.eq(this.current_section).addClass("nav-tab-active"),$("#_cas_section").val("#top"+this.sections[this.current_section]))},actionOptionHandler:function(){var t=$("#cas-options"),e=t.find(".js-cas-action");t.on("change",".js-cas-handle",function(){var t=$(this),n=e.filter(".js-cas-action-"+t.val());e.not(n).hide().find("input,select").attr("disabled",!0),n.fadeIn("fast").find("input,select").attr("disabled",!1)}),t.find(".js-cas-handle").trigger("change")},suggestVisibility:function(){var t=$(".js-cas-visibility");t.select2({theme:"wpca",placeholder:CASAdmin.allVisibility,minimumInputLength:0,closeOnSelect:!0,allowClear:!1,nextSearchTerm:function(t,e){return e},data:CASAdmin.visibility}).on("select2:selecting",function(e){t.data("forceOpen",!0)}).on("select2:close",function(e){t.data("forceOpen")&&(e.preventDefault(),t.select2("open"),t.data("forceOpen",!1))}),t.data("value")&&t.val(t.data("value").toString().split(",")).trigger("change")}};$(document).ready(function(){t.init()})}(jQuery);